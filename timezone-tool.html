<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>部分时区时间转换工具</title>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, select { padding: 5px; margin: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    tr.highlight { background-color: #f0f8ff; }
  </style>
</head>
<body>
  <h2>任意时区时间转换工具</h2>

  <label>输入时间：</label>
  <input type="datetime-local" id="inputTime">
  <label>输入时区：</label>
  <select id="inputZone"></select>

  <button onclick="convert()">转换</button>

  <table>
    <thead>
      <tr>
        <th>UTC 偏移</th>
        <th>常用名称</th>
        <th>时区 ID</th>
        <th>本地时间</th>
      </tr>
    </thead>
    <tbody id="results"></tbody>
  </table>

  <script>
    const { DateTime } = luxon;

    // 常见时区列表（不含偏移，稍后动态计算）
    const timezones = [
      { name: "PST", id: "America/Los_Angeles" },
      { name: "EST", id: "America/New_York" },
      { name: "UTC", id: "UTC" },
      { name: "CET", id: "Europe/Paris" },
      { name: "CST (China)", id: "Asia/Shanghai" },
      { name: "JST", id: "Asia/Tokyo" },
      { name: "AEST", id: "Australia/Sydney" },
      { name: "IST (India)", id: "Asia/Kolkata" },
      { name: "MSK", id: "Europe/Moscow" },
      { name: "BRT", id: "America/Sao_Paulo" }
    ];

    const select = document.getElementById("inputZone");

    // 动态生成下拉选项，显示当前偏移
    timezones.forEach(tz => {
      const now = DateTime.now().setZone(tz.id);
      const offset = now.offset; // 单位：分钟
      const offsetHours = offset / 60;
      const sign = offsetHours >= 0 ? "+" : "";
      const offsetStr = `UTC${sign}${offsetHours}`;

      const option = document.createElement("option");
      option.value = tz.id;
      option.textContent = `${offsetStr} | ${tz.name} | ${tz.id}`;
      select.appendChild(option);
    });

    // 默认选中用户当前时区
    const localZone = DateTime.local().zoneName;
    if ([...select.options].some(opt => opt.value === localZone)) {
      select.value = localZone;
    }

    function convert() {
      const inputTime = document.getElementById("inputTime").value;
      const inputZone = document.getElementById("inputZone").value;

      if (!inputTime || !inputZone) {
        alert("请输入时间和时区！");
        return;
      }

      try {
        const dt = DateTime.fromISO(inputTime, { zone: inputZone });
        if (!dt.isValid) {
          alert("时间或时区无效，请检查！");
          return;
        }

        const tbody = document.getElementById("results");
        tbody.innerHTML = "";

        timezones.forEach(tz => {
          const local = dt.setZone(tz.id);
          const now = DateTime.now().setZone(tz.id);
          const offset = now.offset / 60;
          const offsetStr = `UTC${offset >= 0 ? "+" : ""}${offset}`;

          const row = document.createElement("tr");

          if (tz.name === "CET" || tz.name.includes("China")) {
            row.classList.add("highlight");
          }

          row.innerHTML = `
            <td>${offsetStr}</td>
            <td>${tz.name}</td>
            <td>${tz.id}</td>
            <td>${local.toFormat("yyyy-MM-dd HH:mm:ss")}</td>
          `;
          tbody.appendChild(row);
        });
      } catch (e) {
        alert("转换失败：" + e.message);
      }
    }

    // 默认执行一次（使用当前时间）
    window.addEventListener("DOMContentLoaded", () => {
      const now = DateTime.local().toISO({ suppressMilliseconds: true, includeOffset: false });
      document.getElementById("inputTime").value = now.substring(0, 16); // yyyy-MM-ddTHH:mm
      convert();
    });
  </script>
</body>
</html>
