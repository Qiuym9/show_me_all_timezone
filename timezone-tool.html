<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>UTC 偏移时区转换工具</title>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, select, button { padding: 5px; margin: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f0f0f0; }
  </style>
</head>
<body>
  <h2>UTC 偏移时区转换工具</h2>

  <label>输入时间：</label>
  <input type="datetime-local" id="inputTime">

  <label>输入时区：</label>
  <select id="inputZone"></select>

  <button onclick="convert()">转换</button>

  <table>
    <thead>
      <tr>
        <th>UTC 偏移</th>
        <th>简称</th>
        <th>时区 ID</th>
        <th>本地时间</th>
      </tr>
    </thead>
    <tbody id="results"></tbody>
  </table>

  <script>
    const { DateTime } = luxon;

    // 常见时区及简称（优先使用）
    const timezones = [
      { name: "PST", id: "America/Los_Angeles" },
      { name: "EST", id: "America/New_York" },
      { name: "UTC", id: "UTC" },
      { name: "CET", id: "Europe/Paris" },
      { name: "CST (China)", id: "Asia/Shanghai" },
      { name: "JST", id: "Asia/Tokyo" },
      { name: "AEST", id: "Australia/Sydney" },
      { name: "IST (India)", id: "Asia/Kolkata" },
      { name: "MSK", id: "Europe/Moscow" },
      { name: "BRT", id: "America/Sao_Paulo" }
    ];

    // 构建唯一偏移映射（使用 offsetMinutes 为 key）
    const buildUniqueZones = () => {
      const baseZones = {};

      // 1. 添加默认偏移时区（Etc/GMT±N）
      for (let i = -12; i <= 12; i++) {
        const id = `Etc/GMT${i === 0 ? "" : (i > 0 ? `-${i}` : `+${-i}`)}`;
        const dt = DateTime.now().setZone(id);
        if (!dt.isValid) continue;

        const offset = dt.offset; // in minutes
        baseZones[offset] = {
          id,
          name: "",
          offsetMinutes: offset
        };
      }

      // 2. 用常见时区覆盖（优先）
      timezones.forEach(({ id, name }) => {
        const dt = DateTime.now().setZone(id);
        if (!dt.isValid) return;

        const offset = dt.offset;
        baseZones[offset] = {
          id,
          name,
          offsetMinutes: offset
        };
      });

      // 3. 转换为数组并排序
      return Object.values(baseZones).sort((a, b) => a.offsetMinutes - b.offsetMinutes);
    };

    // 填充下拉菜单
    function populateSelect(zones) {
      const select = document.getElementById("inputZone");
      zones.forEach(({ id, name }) => {
        const option = document.createElement("option");
        option.value = id;
        option.textContent = `${name ? name + " | " : ""}${id}`;
        select.appendChild(option);
      });

      // 默认选择本地时区
      const localZone = DateTime.local().zoneName;
      if ([...select.options].some(opt => opt.value === localZone)) {
        select.value = localZone;
      }
    }

    function formatOffset(offsetMinutes) {
        const sign = offsetMinutes >= 0 ? "+" : "-";
        const abs = Math.abs(offsetMinutes);
        const hours = Math.floor(abs / 60).toString().padStart(2, "0");
        const minutes = (abs % 60).toString().padStart(2, "0");
        return `UTC${sign}${hours}:${minutes}`;
      }
      

    // 执行转换
    function convert() {
      const inputTime = document.getElementById("inputTime").value;
      const inputZone = document.getElementById("inputZone").value;

      if (!inputTime || !inputZone) {
        alert("请输入时间和时区！");
        return;
      }

      const dt = DateTime.fromISO(inputTime, { zone: inputZone });
      if (!dt.isValid) {
        alert("输入的时间或时区无效！");
        return;
      }

      const tbody = document.getElementById("results");
      tbody.innerHTML = "";

      const zones = buildUniqueZones();
      zones.forEach(({ id, name, offsetMinutes }) => {
        const localTime = dt.setZone(id);
        if (!localTime.isValid) return;

        const offsetStr = formatOffset(offsetMinutes);

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${offsetStr.replace(".00", ":00").replace(".50", ":30")}</td>
          <td>${name || ""}</td>
          <td>${id}</td>
          <td>${localTime.toFormat("yyyy-MM-dd HH:mm:ss")}</td>
        `;
        tbody.appendChild(row);
      });
    }

    // 初始化页面
    window.addEventListener("DOMContentLoaded", () => {
      const now = DateTime.local();
      document.getElementById("inputTime").value = now.toISO({ suppressMilliseconds: true }).substring(0, 16);

      const zones = buildUniqueZones();
      populateSelect(zones);
      convert();
    });
  </script>
</body>
</html>
