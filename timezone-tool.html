<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>UTC 偏移时区转换工具</title>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, select, button { padding: 5px; margin: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    tr.highlight { background-color: #f0f8ff; }
    th { background-color: #f0f0f0; }
  </style>
</head>
<body>
  <h2>UTC 偏移时区转换工具</h2>

  <label>输入时间：</label>
  <input type="datetime-local" id="inputTime">

  <label>输入时区：</label>
  <select id="inputZone"></select>

  <button onclick="convert()">转换</button>

  <table>
    <thead>
      <tr>
        <th>UTC 偏移</th>
        <th>简称</th>
        <th>时区 ID</th>
        <th>本地时间</th>
      </tr>
    </thead>
    <tbody id="results"></tbody>
  </table>

  <script>
    const { DateTime } = luxon;

    function getAbbreviation(zone) {
        try {
          const dt = new Date();
          const formatter = new Intl.DateTimeFormat("en-US", {
            timeZone: zone,
            timeZoneName: "short"
          });
          const parts = formatter.formatToParts(dt);
          const abbrev = parts.find(p => p.type === "timeZoneName");
          console.log(abbrev)
          return abbrev ? abbrev.value : "";
        } catch {
          return "";
        }
      }
      
    // defined timezones
    const timezones = [
        "Etc/GMT+12",              // UTC-12
        "Pacific/Pago_Pago",       // UTC-11
        "Pacific/Honolulu",        // UTC-10
        "America/Anchorage",       // UTC-9
        "America/Los_Angeles",     // UTC-8
        "America/Denver",          // UTC-7
        "America/Chicago",         // UTC-6
        "America/New_York",        // UTC-5
        "America/Halifax",         // UTC-4
        "America/Sao_Paulo",       // UTC-3
        "Atlantic/South_Georgia",  // UTC-2
        "Atlantic/Azores",         // UTC-1
        "UTC",                     // UTC+0
        "Europe/London",           // UTC+0/+1
        "Europe/Paris",            // UTC+1/+2
        "Europe/Athens",           // UTC+2/+3
        "Europe/Moscow",           // UTC+3
        "Asia/Dubai",              // UTC+4
        "Asia/Karachi",            // UTC+5
        "Asia/Kolkata",            // UTC+5:30
        "Asia/Dhaka",              // UTC+6
        "Asia/Bangkok",            // UTC+7
        "Asia/Shanghai",           // UTC+8
        "Asia/Tokyo",              // UTC+9
        "Australia/Sydney",        // UTC+10
        "Pacific/Noumea",          // UTC+11
        "Pacific/Auckland",        // UTC+12
        "Pacific/Tongatapu",       // UTC+13
        "Pacific/Kiritimati"       // UTC+14
        ];

    function buildUniqueZones() {
        return timezones.map(id => {
          const dt = DateTime.now().setZone(id);
          return {
            id,
            name: getAbbreviation(id),
            offsetMinutes: dt.offset
          };
        }).sort((a, b) => a.offsetMinutes - b.offsetMinutes);
      }

    // select options
    function populateSelect(zones) {
      const select = document.getElementById("inputZone");

      zones.forEach(({ id, name, offsetMinutes }) => {
        const option = document.createElement("option");
        const offsetStr = formatOffset(offsetMinutes);
        option.value = id;
        option.textContent = `${offsetStr} | ${name ? name + " | " : ""}${id}`;
        select.appendChild(option);
      });

      // 默认选择本地时区
      const localZone = DateTime.local().zoneName;
      if ([...select.options].some(opt => opt.value === localZone)) {
        select.value = localZone;
      }
    }

    function formatOffset(offsetMinutes) {
        const sign = offsetMinutes >= 0 ? "+" : "-";
        const abs = Math.abs(offsetMinutes);
        const hours = Math.floor(abs / 60).toString().padStart(2, "0");
        const minutes = (abs % 60).toString().padStart(2, "0");
        return `UTC${sign}${hours}:${minutes}`;
      }
      
    function convert() {
      const inputTime = document.getElementById("inputTime").value;
      const inputZone = document.getElementById("inputZone").value;

      if (!inputTime || !inputZone) {
        alert("请输入时间和时区！");
        return;
      }

      const dt = DateTime.fromISO(inputTime, { zone: inputZone });
      if (!dt.isValid) {
        alert("输入的时间或时区无效！");
        return;
      }

      const tbody = document.getElementById("results");
      tbody.innerHTML = "";

      const zones = buildUniqueZones();
      zones.forEach(({ id, name, offsetMinutes }) => {
        const localTime = dt.setZone(id);
        if (!localTime.isValid) return;

        const offsetStr = formatOffset(offsetMinutes);

        const row = document.createElement("tr");
        
        // for my usage
        if (id.includes("Asia/Shanghai") || id.includes("Europe/Paris")) {
            row.classList.add("highlight");
        }
      
        row.innerHTML = `
          <td>${offsetStr.replace(".00", ":00").replace(".50", ":30")}</td>
          <td>${name || ""}</td>
          <td>${id}</td>
          <td>${localTime.toFormat("yyyy-MM-dd HH:mm:ss")}</td>
        `;
        tbody.appendChild(row);
      });
    }

    // init page
    window.addEventListener("DOMContentLoaded", () => {
      const now = DateTime.local();
      document.getElementById("inputTime").value = now.toISO({ suppressMilliseconds: true }).substring(0, 16);

      const zones = buildUniqueZones();
      populateSelect(zones);
      convert();
    });
  </script>
</body>
</html>
